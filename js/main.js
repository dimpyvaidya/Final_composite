let products = [{
        id: 1111,
        name: 'Nice Watch',
        price: '199',
        rating: '3',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'chain',
        color: 'black',
        deal: 'new',
        qty: '3',
        image: 'images/wap1.jpg'
    },
    {
        id: 1112,
        name: 'Red Watch',
        price: '150',
        rating: '2',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'sports',
        color: 'all',
        deal: 'new',
        qty: '1',
        image: 'images/wap2.jpg'
    },
    {
        id: 1113,
        name: 'Dobo Watch',
        price: '200',
        rating: '4',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'casual',
        color: 'gold',
        deal: 'new',
        qty: '60',
        image: 'images/wap3.jpg'
    },
    {
        id: 1114,
        name: 'Hodo Watch',
        price: '250',
        rating: '3',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'leather',
        color: 'brown',
        deal: 'twenty',
        qty: '4',
        image: 'images/wap4.jpg'
    },
    {
        id: 1115,
        name: 'P-Shock Watch',
        price: '280',
        rating: '4',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'sports',
        color: 'black',
        deal: 'twenty',
        qty: '3',
        image: 'images/wap5.jpg'
    },
    {
        id: 1116,
        name: 'xxxx Watch',
        price: '310',
        rating: '5',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'casual',
        color: 'blue',
        deal: 'twenty',
        qty: '10',
        image: 'images/wap6.jpg'
    },
    {
        id: 1117,
        name: 'Max Watch',
        price: '350',
        rating: '5',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'leather',
        color: 'brown',
        deal: 'fifty',
        qty: '100',
        image: 'images/wap7.jpg'
    },
    {
        id: 1118,
        name: 'Ruhu Watch',
        price: '400',
        rating: '1',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'chain',
        color: 'black',
        deal: 'fifty',
        qty: '120',
        image: 'images/wap8.jpg'
    },
    {
        id: 1119,
        name: 'huku Watch',
        price: '500',
        rating: '4',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'sports',
        color: 'black',
        deal: 'fifty',
        qty: '10',
        image: 'images/wap9.jpg'
    },
    {
        id: 1120,
        name: 'Nice Watch',
        price: '99',
        rating: '3',
        description: "Nice Watch",
        category: 'watches',
        type: 'chain',
        color: 'gold',
        deal: 'new',
        qty: '110',
        image: 'images/wap10.jpg'
    },
    {
        id: 1121,
        name: 'Red Watch',
        price: '195',
        rating: '4',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'leather',
        color: 'brown',
        deal: 'new',
        qty: '10',
        image: 'images/wap11.jpg'
    },
    {
        id: 1122,
        name: 'Titan Watch',
        price: '220',
        rating: '4',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'leather',
        color: 'brown',
        deal: 'new',
        qty: '100',
        image: 'images/wap12.jpg'
    },
    {
        id: 1123,
        name: 'Hodo Watch',
        price: '260',
        rating: '3',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'leather',
        color: 'blue',
        deal: 'twenty',
        qty: '2',
        image: 'images/wap13.jpg'
    },
    {
        id: 1124,
        name: 'S-Shock Watch',
        price: '420',
        rating: '4',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'chain',
        color: 'gold',
        deal: 'twenty',
        qty: '1',
        image: 'images/wap14.jpg'
    },
    {
        id: 1125,
        name: 'quizt Watch',
        price: '310',
        rating: '5',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'chain',
        color: 'blue',
        deal: 'twenty',
        qty: '10',
        image: 'images/wap15.jpg'
    },
    {
        id: 1126,
        name: 'Rado Watch',
        price: '350',
        rating: '5',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'casual',
        color: 'all',
        deal: 'fifty',
        qty: '102',
        image: 'images/wap16.jpg'
    },
    {
        id: 1127,
        name: 'Ruhu Watch',
        price: '400',
        rating: '1',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'chain',
        color: 'blue',
        deal: 'fifty',
        qty: '1',
        image: 'images/wap17.jpg'
    },
    {
        id: 1128,
        name: 'huku Watch',
        price: '500',
        rating: '4',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'casual',
        color: 'all',
        deal: 'fifty',
        qty: '109',
        image: 'images/wap18.jpg'
    },
    {
        id: 1129,
        name: 'Timex Watch',
        price: '400',
        rating: '1',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'leather',
        color: 'black',
        deal: 'fifty',
        qty: '10',
        image: 'images/wap19.jpg'
    },
    {
        id: 1130,
        name: 'G-shok Watch',
        price: '530',
        rating: '4',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'watches',
        type: 'casual',
        color: 'blue',
        deal: 'fifty',
        qty: '11',
        image: 'images/wap20.jpg'
    },
    {
        id: 1131,
        name: 'GIORDANO',
        price: '899',
        rating: '2',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'handbag',
        type: 'leather',
        color: 'black',
        deal: 'new',
        qty: '10',
        image: 'images/hp1.jpg'
    },
    {
        id: 1132,
        name: 'Diana Korr',
        price: '299',
        rating: '3',
        description: "Shipping Weight: 81.6 | Batteries 1 Lithium Metal batteries required. (included)| Item model number: 4332841807 | Model Year : 2019 | Water resistant depth : 100.00 Feet",
        category: 'handbag',
        type: 'leather',
        color: 'all',
        deal: 'new',
        qty: '102',
        image: 'images/hp2.jpg'
    },
    {
        id: 1133,
        name: 'Caprese',
        price: '799',
        rating: '3',
        description: "Caprese bag",
        category: 'handbag',
        type: 'leather',
        color: 'black',
        deal: 'new',
        qty: '102',
        image: 'images/hp3.jpg'
    },
    {
        id: 1134,
        name: 'Diana Korr',
        price: '399',
        rating: '3',
        description: "Diana Korr",
        category: 'handbag',
        type: 'leather',
        color: 'all',
        deal: 'new',
        qty: '10',
        image: 'images/hp4.jpg'
    },
    {
        id: 1135,
        name: 'Wildcraft',
        price: '599',
        rating: '3',
        description: "Wildcraft bag",
        category: 'handbag',
        type: 'leather',
        color: 'all',
        deal: 'new',
        qty: '120',
        image: 'images/hp5.jpg'
    },
    {
        id: 1136,
        name: 'Diana Korr',
        price: '499',
        rating: '3',
        description: "Diana Korr ",
        category: 'handbag',
        type: 'leather',
        color: 'black',
        deal: 'new',
        qty: '1',
        image: 'images/hp6.jpg'
    },
    {
        id: 1137,
        name: 'Lino Perros',
        price: '800',
        rating: '3',
        description: "Lino Perros",
        category: 'handbag',
        type: 'leather',
        color: 'brown',
        deal: 'new',
        qty: '1',
        image: 'images/hp7.jpg'
    },
    {
        id: 1138,
        name: 'Caprese',
        price: '350',
        rating: '3',
        description: "Caprese bag",
        category: 'handbag',
        type: 'leather',
        color: 'black',
        deal: 'new',
        qty: '2',
        image: 'images/hp8.jpg'
    },
    {
        id: 1139,
        name: 'Alessia',
        price: '999',
        rating: '3',
        description: "Alessia bag",
        category: 'handbag',
        type: 'leather',
        color: 'brown',
        deal: 'new',
        qty: '10',
        image: 'images/hp9.jpg'
    },
];

let records_per_page = 9;
let main_product_list = products;
let current_page = 1;
let pr_cate = 'watches';

//by default watches
let watchedArray = products.filter(function(itm) {
    return itm.category == 'watches';
});
let filterOptions = [];
let str = getProductList(watchedArray);

document.getElementById('products_list').innerHTML = str;

let classname = document.getElementsByClassName("filter");
let arr_filter = document.getElementsByClassName("attr-filter");
let price_filter = document.getElementsByClassName("price-filter");
let star_filter = document.getElementsByClassName("star-filter");
let sort_filter = document.getElementsByClassName("sort-filter");

//watch-bag toggle

let myFunction = function() {
    let attribute = this.getAttribute("data-type");
    if (attribute == 'handbag') {
        pr_cate = 'handbag';
        let HandbagArray = products.filter(function(itm) {
            return itm.category == 'handbag';
        });
        let str = getProductList(HandbagArray);
        document.getElementById('products_list').innerHTML = str;
    } else {
        pr_cate = 'wacthes';
        let watchedArray = products.filter(function(itm) {
            return itm.category == 'watches';
        });

        let str = getProductList(watchedArray);
        document.getElementById('products_list').innerHTML = str;
    }
};


//display products
function getProductList(plist, page = 1) {
    main_product_list = plist;
    let btn_next = document.getElementById("btn_next");
    let btn_prev = document.getElementById("btn_prev");
    let listing_table = document.getElementById("products_list");
    let page_span = document.getElementById("page");

    if (page < 1) page = 1;
    if (page > numPages(plist)) page = numPages(plist);

    listing_table.innerHTML = "";

    let str = '';

    for (let i = (page - 1) * records_per_page; i < (page * records_per_page) && i < plist.length; i++) {
        str = str + '<div class="filter_portion product_block">';
        str = str + '<a href="javascript:;" onClick="details(' + plist[i].id + ')"><div class="product-img">';
        str = str + '<img src="' + plist[i].image + '" alt="" />';
        str = str + '</div></a>';
        let gold_star_length = parseInt(plist[i].rating);
        let gray_star_length = 5 - parseInt(plist[i].rating);
        for (let k = 0; k < gold_star_length; k++) {
            str = str + "<i><img src='images/star.png' class='starimg' aria-hidden='true'></i>";
        }
        for (let k = 0; k < gray_star_length; k++) {
            str = str + "<i><img src='images/star-gray.png' class='starimg' aria-hidden='true'></i>";
        }
        str = str + '<h4>' + plist[i].name + '</h4>';
        str = str + '<h4 class="price">' + '$' + plist[i].price + '</h4>';
        // quantity will color change
        if (plist[i].qty == 1) {
            str = str + '<h5 class="qty_one">' + 'Hurry up !!! Only ' + plist[i].qty + ' left' + '</h5>';
        } else if (plist[i].qty > 1 && plist[i].qty < 5) {
            str = str + '<h5 class="qty_less_five">' + 'Only ' + plist[i].qty + ' left !' + '</h5>';
        } else if (plist[i].qty > 5 && plist[i].qty < 50) {
            str = str + '<h5 class="qty_less_fifty">' + plist[i].qty + ' available ' + '</h5>';
        } else {
            str = str + '<h5 class="qty_avail">' + 'Stock available' + '</h5>';
        }

        // 
        str = str + '<button class="cart_button">Add to Cart</button>';
        str = str + '<button class="cart_button">Buy Now</button></div>';
    }

    page_span.innerHTML = page + " of " + numPages(plist);

    if (page == 1) {
        btn_prev.style.visibility = "hidden";
    } else {
        btn_prev.style.visibility = "visible";
    }

    if (page == numPages(plist)) {
        btn_next.style.visibility = "hidden";
    } else {
        btn_next.style.visibility = "visible";
    }
    return str;
}

//clear search
function clearAllFilters() {
    window.location.reload();
}

//searching product
function searchProduct() {
    let value = (document.getElementById("product_name").value).toLowerCase();
    let nameArray = products.filter(function(itm) {
        let name = itm.name.toLowerCase();
        return name.indexOf(value) >= 0 && itm.category == pr_cate;
    });
    let str = getProductList(nameArray);
    document.getElementById('products_list').innerHTML = str;
}


//particular product 
function details(id) {
    product = products.find(x => x.id === id);
    let image = '<img  src="' + product.image + '" data-imagezoom="true" alt="">';
    let name = product.name;
    let description = "<h4>Product Description :</h4>" + product.description + '<br><br>';
    let gold_star_length = parseInt(product.rating);
    let gray_star_length = 5 - parseInt(product.rating);
    rating = '';
    for (let k = 0; k < gold_star_length; k++) {
        rating = rating + "<i><img src='images/star.png' class='starimg' aria-hidden='true'></i>";
    }
    for (let k = 0; k < gray_star_length; k++) {
        rating = rating + "<i><img src='images/star-gray.png' class='starimg' aria-hidden='true'></i>";
    }

    let price = '$' + product.price;
    document.getElementById('pdetails_image').innerHTML = image;
    document.getElementById('pdetails_name').innerHTML = name;
    document.getElementById('pdetails_desc').innerHTML = description;
    document.getElementById('pdetails_rating').innerHTML = rating;
    document.getElementById('pdetails_price').innerHTML = price;
    document.getElementById('pdetails_category').innerHTML = product.category;
    document.getElementById('pdetails_color').innerHTML = product.color;
    document.getElementById('pdetails_type').innerHTML = product.type;
    document.getElementById('details').classList.remove("hidden");
    document.getElementById('products_list').classList.add("hidden");
    document.getElementById('pagination_bloack').classList.add("hidden");
}

// go back to home page
function backToList() {
    document.getElementById('products_list').classList.remove("hidden");
    document.getElementById('details').classList.add("hidden");
    document.getElementById('pagination_bloack').classList.remove("hidden");
}

//Sort : ascending-descending sort
function sortByKey(array, key, order) {
    if (order == 'asc') {
        return array.sort(function(a, b) {
            let x = a[key];
            let y = b[key];
            return ((x < y) ? -1 : ((x > y) ? 1 : 0));
        });
    } else {
        return array.sort(function(a, b) {
            let x = a[key];
            let y = b[key];
            return ((x > y) ? -1 : ((x < y) ? 1 : 0));
        });
    }
}

//Sort : price filter  
let sortFilter = function() {
    let value = this.getAttribute("data-type");
    let filter = products.filter(function(itm) {
        return itm.category == pr_cate;
    });
    if (value == 'name')
        var result = sortByKey(filter, value, this.getAttribute("data-val"));
    else {
        if (this.getAttribute("data-val") == 'asc') {
            var result = filter.sort(function(a, b) {
                var x = parseInt(a.price);
                var y = parseInt(b.price);
                return ((x < y) ? -1 : ((x > y) ? 1 : 0));
            });
        } else {
            var result = filter.sort(function(a, b) {
                var x = parseInt(a.price);
                var y = parseInt(b.price);
                return ((x > y) ? -1 : ((x < y) ? 1 : 0));
            });
        }
    }
    var str = getProductList(result);
    document.getElementById('products_list').innerHTML = str;
}


//price filter
let priceFilter = function() {
    let value = this.getAttribute("data-val");
    let HandbagArray = products.filter(function(itm) {
        return parseInt(itm.price) <= parseInt(value) && itm.category == pr_cate;
    });
    let str = getProductList(HandbagArray);
    document.getElementById('products_list').innerHTML = str;
};

//category filter
let filtering = function() {
    let type = this.getAttribute("data-type");
    let val = this.getAttribute("data-val");
    const found = filterOptions.some(el => el[type] === val);
    if (!found) {
        filterOptions.push({
            [type]: val
        });
    }
    let condition = '';
    let filter_array = [];
    for (let product in products) {
        for (let filter in filterOptions) {
            for (let key in filterOptions[filter]) {
                if (products[product][key] == filterOptions[filter][key] && products[product].category == pr_cate) {
                    filter_array.push(products[product]);
                }
            }
        }
    }
    let element = document.getElementById("clr_btn");
    element.classList.remove("hidden");
    let str = getProductList(filter_array);
    document.getElementById('products_list').innerHTML = str;
}

//star filter
let starFilter = function() {
    let type = this.getAttribute("data-type");
    let val = this.getAttribute("data-val");
    filterOptions = filterOptions.filter(function(item, index, obj) {
        return !("rating" in item);
    });
    filterOptions.push({
        [type]: val
    });
    let condition = '';
    let filter_array = [];
    for (let product in products) {
        for (let filter in filterOptions) {
            for (let key in filterOptions[filter]) {
                if (products[product][key] == filterOptions[filter][key] && products[product].category == pr_cate) {
                    filter_array.push(products[product]);
                }
            }
        }
    }
    let element = document.getElementById("clr_btn");
    element.classList.remove("hidden");
    let str = getProductList(filter_array);
    document.getElementById('products_list').innerHTML = str;
}


/* Pagination */
function prevPage() {
    if (current_page > 1) {
        current_page--;
        let str = getProductList(main_product_list, current_page);
        document.getElementById('products_list').innerHTML = str;
    }
}

function nextPage() {
    if (current_page < numPages(main_product_list)) {
        current_page++;
        let str = getProductList(main_product_list, current_page);
        document.getElementById('products_list').innerHTML = str;
    }
}

function numPages(objJson) {
    return Math.ceil(objJson.length / records_per_page);
}

//calling function

for (let i = 0; i < classname.length; i++) {
    classname[i].addEventListener('click', myFunction, false);
}
for (let i = 0; i < arr_filter.length; i++) {
    arr_filter[i].addEventListener('click', filtering, false);
}
for (var i = 0; i < price_filter.length; i++) {
    price_filter[i].addEventListener('click', priceFilter, false);
}
for (let i = 0; i < star_filter.length; i++) {
    star_filter[i].addEventListener('click', starFilter, false);
}
for (let i = 0; i < sort_filter.length; i++) {
    sort_filter[i].addEventListener('click', sortFilter, false);
}
document.getElementById("clr_btn").onclick = clearAllFilters;
document.getElementById("search_btn").onclick = searchProduct;
document.getElementById("back_to_list").onclick = backToList;
document.getElementById("btn_prev").onclick = prevPage;
document.getElementById("btn_next").onclick = nextPage;